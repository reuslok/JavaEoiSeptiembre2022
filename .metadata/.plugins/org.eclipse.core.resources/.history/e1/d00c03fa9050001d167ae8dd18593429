package es.eoi.app;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.Scanner;

import es.eoi.config.BBDDUtils;

public class Main {
	public static Statement st ;
	public static ResultSet rsComumidades ;
	public static ResultSet rsProvincias ;
	public static Connection conexion;
	public static Scanner sc= new Scanner(System.in);

	public static void main(String[] args) {

		try {

			conexion = BBDDUtils.openConnection();

			System.out.println("Conectado:"+BBDDUtils.BBDD_URL);
			try {
				st = Main.conexion.createStatement();
				rsComumidades = st.executeQuery("SELECT * FROM comunidades");
				rsProvincias = st.executeQuery("SELECT * FROM provincias");
				menu();
			} catch (SQLException e) {
				System.out.println("Error al ejecutar la consulta a BBDD.");
				e.printStackTrace();
			}
			

			conexion.close();
			
		}
		
		catch (SQLException e)
		{

			System.out.println("Error al abrir conexión a BBDD.");

			e.printStackTrace();

		}
	}

	private static void menu() throws SQLException {
		System.out.println("01    ANDALUCIA\r\n"
				+ "02    ARAGON\r\n"
				+ "03    ASTURIAS\r\n"
				+ "04    ISLAS BALEARES\r\n"
				+ "05    ISLAS CANARIAS\r\n"
				+ "06    CANTABRIA\r\n"
				+ "07    CASTILLA Y LEON\r\n"
				+ "08    CASTILLA-LA MANCHA\r\n"
				+ "09    CATALUNYA\r\n"
				+ "10    COMUNICAD VALENCIANA\r\n"
				+ "11    EXTREMADURA\r\n"
				+ "12    GALICIA\r\n"
				+ "13    MADRID\r\n"
				+ "14    MURCIA\r\n"
				+ "15    NAVARRA\r\n"
				+ "16    PAIS VASCO\r\n"
				+ "17    LA RIOJA\r\n"
				+ "18    CEUTA\r\n"
				+ "19    MELILLA");
		
		System.out.println("Introduce el código de la comunidad autónoma que desees:");
		BuscaAlumno();
		
	}
	private static void BuscaAlumno() throws SQLException {
		String DNI="";
		while(DNI.length()!=10) {
		System.out.println("Inserte DNI");
		DNI=sc.nextLine();
		if(DNI.length()!=10) {
			System.out.println("longitud de DNI incorrecta");
			}
		else {
		}
		
		StringBuilder sql = new StringBuilder();
		sql.append("SELECT * FROM ALUMNO WHERE DNI = ?;");
		PreparedStatement pst = Main.conexion.prepareStatement(sql.toString());
		pst.setString(1, DNI);
		Main.rs= pst.executeQuery();
		while(Main.rs.next()) {
			System.out.println(Main.rs.getString("DNI").concat(" - ").concat(
					Main.rs.getString("NOMBRE")).concat(" - ").concat(
					Main.rs.getString("APELLIDOS")).concat(" - ")+
					Main.rs.getInt("EDAD"));
			}
		}
	}
}
